<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <title>One-page Application Example</title>
    <meta charset="utf-8" />
    <meta name="Author" content="Ray Nham" />
    <meta name="Description" content="" />

    <link rel='stylesheet' href='css/bootstrap/bootstrap.min.css' />
    <link rel='stylesheet' href='css/custom.css' />
</head>

<body>
    <div class="container">
        <div class="jumbotron">
            <h1>Product Index (One Page App - Knockoutjs)</h1>
        </div>
        <p>
            <button class="btn-create btn btn-primary" data-bind="click: addProduct">Add Product</button>
        </p>

        <!-- Start: List of product items -->
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th scope="col">
                        ID
                    </th>
                    <th scope="col">
                        Name
                    </th>
                    <th scope="col">
                        Price ($AUD)
                    </th>
                    <th scope="col">
                        Company
                    </th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>

            <tbody data-bind="foreach: products">
                <tr data-bind="visible: isActive">
                    <td data-bind="text: ID" scope="row"></td>
                    <td data-bind="text: productName"></td>
                    <td data-bind="text: productPrice"></td>
                    <td data-bind="text: companyName"></td>

                    <td>
                        <a href="javascript:void(0);" class="btn-details btn btn-primary" data-bind="click: $parent.viewProduct">Details</a>
                        <a href="javascript:void(0);" class="btn-edit btn btn-success" data-bind="click: $parent.editProduct">Edit</a>
                        <a href="javascript:void(0);" class="btn-delete btn btn-danger" data-bind="click: $parent.deleteProduct">Delete</a>
                    </td>
                </tr>
            </tbody>
        </table>
        <!-- End: List of product items -->

        <!-- Button to recover recent deleted task -->
        <a href="javascript:void(0);" class="pull-right" data-bind="click: recoverDeletedItems">Recover deleted items</a>

        <!-- Start: Modal for ADD operation -->
        <div id="add-product-modal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-body">
                        <!-- Modal content goes here -->
                        <div class="form-horizontal" data-bind="with: newProduct">
                            <h4>Add Product</h4>
                            <hr />
                            <div class="form-group row">
                                <label for="name-input" class="col-4 col-form-label">Name</label>
                                <div class="col-8">
                                    <input class="form-control" id="name-input" data-bind="value: productName">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="price-input" class="col-4 col-form-label">Price ($AUD)</label>
                                <div class="col-8">
                                    <input class="form-control" id="price-input" data-bind="value: productPrice">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="price-input" class="col-4 col-form-label">Comapny</label>
                                <div class="col-8">
                                    <input class="form-control" id="company-input" data-bind="value: companyName">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal" data-bind="click: addConfirmed">Save</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- End: Modal for ADD operation -->
        <!-- Start: Modal for VIEW operation -->
        <div id="view-product-modal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-body">
                        <!-- Modal content goes here -->
                        <h2>Details</h2>
                        <div class="form-horizontal" data-bind="with: selectedProduct">
                            <h4>Product</h4>
                            <hr />
                            <dl class="dl-horizontal">
                                <div class="form-group row">
                                    <label class="col-4">ID</label>
                                    <div class="col-8">
                                        <p data-bind="text: ID" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-4">Name</label>
                                    <div class="col-8">
                                        <p data-bind="text: productName" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-4">Price ($AUD)</label>
                                    <div class="col-8">
                                        <p data-bind="text: productPrice" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-4">Company</label>
                                    <div class="col-8">
                                        <p data-bind="text: companyName" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-4">Added Date</label>
                                    <div class="col-8">
                                        <p data-bind="text: addedDate" />
                                    </div>
                                </div>
                            </dl>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- End: Modal for VIEW operation -->
        <!-- Start: Modal for EDIT operation -->
        <div id="edit-product-modal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-body">
                        <!-- Modal content goes here -->
                        <div class="form-horizontal" data-bind="with: newProduct">
                            <h4>Edit Product</h4>
                            <hr />
                            <div class="form-group row">
                                <label for="name-input" class="col-2 col-form-label">Name</label>
                                <div class="col-10">
                                    <input class="form-control" id="name-input" data-bind="value: productName">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="price-input" class="col-2 col-form-label">Price ($AUD)</label>
                                <div class="col-10">
                                    <input class="form-control" id="price-input" data-bind="value: productPrice">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="price-input" class="col-2 col-form-label">Comapny</label>
                                <div class="col-10">
                                    <input class="form-control" id="company-input" data-bind="value: companyName">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal" data-bind="click: editConfirmed">Save</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- End: Modal for EDIT operation -->
        <!-- Start Modal for DELETE operation -->
        <div id="delete-product-modal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-body">
                        <!-- Modal content goes here -->
                        <h2>Delete</h2>
                        <h3>Are you sure you want to delete this?</h3>
                        <div id="delete-product" data-bind="with: selectedProduct">
                            <h4>Product</h4>
                            <hr />
                            <dl class="dl-horizontal">
                                <div class="form-group row">
                                    <label class="col-4">ID</label>
                                    <div class="col-8">
                                        <p data-bind="text: ID" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-4">Name</label>
                                    <div class="col-8">
                                        <p data-bind="text: productName" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-4">Price ($AUD)</label>
                                    <div class="col-8">
                                        <p data-bind="text: productPrice" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-4">Company</label>
                                    <div class="col-8">
                                        <p data-bind="text: companyName" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-4">Added Date</label>
                                    <div class="col-8">
                                        <p data-bind="text: addedDate" />
                                    </div>
                                </div>
                            </dl>
                            <input hidden data-bind="value: ID" id="ID" name="ID" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="button" value="Delete" class="btn btn-default" data-bind="click: deleteConfirmed" data-dismiss="modal" />
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- End: Modal for DELETE operation -->
    </div>
    <!-- Close div container -->

    <!-- Import external JavaScript files -->
    <script type='text/javascript' src='js/jquery-3.3.1.min.js'></script>
    <script type='text/javascript' src='js/bootstrap/bootstrap.min.js'></script>
    <script type='text/javascript' src='js/knockoutjs/knockout-3.4.2.js'></script>
    <script type='text/javascript' src='js/knockoutjs/knockout.mapping-2.0.js'></script>
    <script type='text/javascript' src='js/product.js'></script>
    <!-- Custom Javascript -->
    <script type="text/javascript">
        /* A function to get current date in dd/mm/yyyy format.
         * params: none. return: string.
         */
        function getCurrentDate() {
            var date = new Date();
            //convert month to 2 digits
            var twoDigitMonth = (date.getMonth().length === 1) ? '0' + (date.getMonth() + 1) : (date.getMonth() + 1);
            var currentDate = date.getDate() + "/" + twoDigitMonth + "/" + date.getFullYear();
            return currentDate;
        }
        /* the Model class for Product item.
         * param: data (JSON or JS object format)
         * return: an instance of Product model.
         */
        function Product(data) {
            var self = this;
            self.ID = (data ? ko.observable(data.ID) : ko.observable());
            self.productName = (data ? ko.observable(data.productName) : ko.observable());
            self.productPrice = (data ? ko.observable(data.productPrice) : ko.observable());
            self.companyName = (data ? ko.observable(data.companyName.toUpperCase()) : ko.observable());
            self.addedDate = (data ? ko.observable(data.addedDate) : ko.observable());
            self.isActive = (data ? ko.observable(data.isActive) : ko.observable());
        }
        // The page ViewModel definition.
        function PageViewModel(data) {
            var self = this;
            // An array to store a list of the product items.
            self.products = ko.observableArray();
            // Inject existing data in the json file into the productList.
            for (var key in data) {
                self.products.push(new Product(ko.toJS(data[key])));
            }
            // Some placeholders to stores data as users interact with the page.
            self.selectedProduct = ko.observable();
            self.newProduct = ko.observable();
            self.selectedProductPointer = null;

            // The function to add new product item into the list of product.
            self.addProduct = function () {
                var product = new Product();
                product.ID(self.products().length + 1);
                product.addedDate(getCurrentDate());
                product.isActive(true);
                self.newProduct(ko.toJS(product));
                $('#add-product-modal').modal('show');
            }
            self.addConfirmed = function () {
                self.products.push(new Product(ko.toJS(self.newProduct)));
            }
            // The function to edit a product item.
            self.viewProduct = function (item) {
                self.selectedProduct(item);
                $('#view-product-modal').modal('show');
            }

            self.editProduct = function (item) {
                self.selectedProductPointer = item;
                self.newProduct(new Product(ko.toJS(item)));
                $('#edit-product-modal').modal('show');
            }
            self.editConfirmed = function (item) {
                self.products.replace(self.selectedProductPointer,
                    new Product(ko.toJS(self.newProduct)));
            }
            // The function to delete a product item.
            self.deleteProduct = function (item) {
                self.selectedProduct(item);
                self.selectedProductPointer = item;
                $('#delete-product-modal').modal('show');
            }
            self.deleteConfirmed = function () {
                var product = new Product(ko.toJS(self.selectedProduct));
                product.isActive(false);
                self.products.replace(self.selectedProductPointer, product);
            }
            // The function to recover all deleted items.
            self.recoverDeletedItems = function () {
                for (var i = 0; i < self.products().length; i++) {
                    if (!self.products()[i].isActive()) {
                        self.products()[i].isActive(true);
                    }
                }
            }
        }

        $('document').ready(function () {
            // Attach an instance of PageViewModel into this page.
            ko.applyBindings(new PageViewModel(data));
        });

    </script>
</body>

</html>